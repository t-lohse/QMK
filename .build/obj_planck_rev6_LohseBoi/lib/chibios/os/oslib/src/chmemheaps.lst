   1              		.cpu cortex-m4
   2              		.eabi_attribute 27, 1
   3              		.eabi_attribute 28, 1
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 4
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 2
  13              		.file	"chmemheaps.c"
  14              		.text
  15              	.Ltext0:
  16              		.cfi_sections	.debug_frame
  17              		.section	.text._heap_init,"ax",%progbits
  18              		.align	1
  19              		.global	_heap_init
  20              		.arch armv7e-m
  21              		.syntax unified
  22              		.thumb
  23              		.thumb_func
  24              		.fpu fpv4-sp-d16
  26              	_heap_init:
  27              	.LFB289:
  28              		.file 1 "lib/chibios/os/oslib/src/chmemheaps.c"
   1:lib/chibios/os/oslib/src/chmemheaps.c **** /*
   2:lib/chibios/os/oslib/src/chmemheaps.c ****     ChibiOS - Copyright (C) 2006..2018 Giovanni Di Sirio.
   3:lib/chibios/os/oslib/src/chmemheaps.c **** 
   4:lib/chibios/os/oslib/src/chmemheaps.c ****     This file is part of ChibiOS.
   5:lib/chibios/os/oslib/src/chmemheaps.c **** 
   6:lib/chibios/os/oslib/src/chmemheaps.c ****     ChibiOS is free software; you can redistribute it and/or modify
   7:lib/chibios/os/oslib/src/chmemheaps.c ****     it under the terms of the GNU General Public License as published by
   8:lib/chibios/os/oslib/src/chmemheaps.c ****     the Free Software Foundation; either version 3 of the License, or
   9:lib/chibios/os/oslib/src/chmemheaps.c ****     (at your option) any later version.
  10:lib/chibios/os/oslib/src/chmemheaps.c **** 
  11:lib/chibios/os/oslib/src/chmemheaps.c ****     ChibiOS is distributed in the hope that it will be useful,
  12:lib/chibios/os/oslib/src/chmemheaps.c ****     but WITHOUT ANY WARRANTY; without even the implied warranty of
  13:lib/chibios/os/oslib/src/chmemheaps.c ****     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  14:lib/chibios/os/oslib/src/chmemheaps.c ****     GNU General Public License for more details.
  15:lib/chibios/os/oslib/src/chmemheaps.c **** 
  16:lib/chibios/os/oslib/src/chmemheaps.c ****     You should have received a copy of the GNU General Public License
  17:lib/chibios/os/oslib/src/chmemheaps.c ****     along with this program.  If not, see <http://www.gnu.org/licenses/>.
  18:lib/chibios/os/oslib/src/chmemheaps.c **** */
  19:lib/chibios/os/oslib/src/chmemheaps.c **** 
  20:lib/chibios/os/oslib/src/chmemheaps.c **** /**
  21:lib/chibios/os/oslib/src/chmemheaps.c ****  * @file    oslib/src/chmemheaps.c
  22:lib/chibios/os/oslib/src/chmemheaps.c ****  * @brief   Memory heaps code.
  23:lib/chibios/os/oslib/src/chmemheaps.c ****  *
  24:lib/chibios/os/oslib/src/chmemheaps.c ****  * @addtogroup oslib_memheaps
  25:lib/chibios/os/oslib/src/chmemheaps.c ****  * @details Heap Allocator related APIs.
  26:lib/chibios/os/oslib/src/chmemheaps.c ****  *          <h2>Operation mode</h2>
  27:lib/chibios/os/oslib/src/chmemheaps.c ****  *          The heap allocator implements a first-fit strategy and its APIs
  28:lib/chibios/os/oslib/src/chmemheaps.c ****  *          are functionally equivalent to the usual @p malloc() and @p free()
  29:lib/chibios/os/oslib/src/chmemheaps.c ****  *          library functions. The main difference is that the OS heap APIs
  30:lib/chibios/os/oslib/src/chmemheaps.c ****  *          are guaranteed to be thread safe and there is the ability to
  31:lib/chibios/os/oslib/src/chmemheaps.c ****  *          return memory blocks aligned to arbitrary powers of two.<br>
  32:lib/chibios/os/oslib/src/chmemheaps.c ****  * @pre     In order to use the heap APIs the @p CH_CFG_USE_HEAP option must
  33:lib/chibios/os/oslib/src/chmemheaps.c ****  *          be enabled in @p chconf.h.
  34:lib/chibios/os/oslib/src/chmemheaps.c ****  * @note    Compatible with RT and NIL.
  35:lib/chibios/os/oslib/src/chmemheaps.c ****  * @{
  36:lib/chibios/os/oslib/src/chmemheaps.c ****  */
  37:lib/chibios/os/oslib/src/chmemheaps.c **** 
  38:lib/chibios/os/oslib/src/chmemheaps.c **** #include "ch.h"
  39:lib/chibios/os/oslib/src/chmemheaps.c **** 
  40:lib/chibios/os/oslib/src/chmemheaps.c **** #if (CH_CFG_USE_HEAP == TRUE) || defined(__DOXYGEN__)
  41:lib/chibios/os/oslib/src/chmemheaps.c **** 
  42:lib/chibios/os/oslib/src/chmemheaps.c **** /*===========================================================================*/
  43:lib/chibios/os/oslib/src/chmemheaps.c **** /* Module local definitions.                                                 */
  44:lib/chibios/os/oslib/src/chmemheaps.c **** /*===========================================================================*/
  45:lib/chibios/os/oslib/src/chmemheaps.c **** 
  46:lib/chibios/os/oslib/src/chmemheaps.c **** /*
  47:lib/chibios/os/oslib/src/chmemheaps.c ****  * Defaults on the best synchronization mechanism available.
  48:lib/chibios/os/oslib/src/chmemheaps.c ****  */
  49:lib/chibios/os/oslib/src/chmemheaps.c **** #if (CH_CFG_USE_MUTEXES == TRUE) || defined(__DOXYGEN__)
  50:lib/chibios/os/oslib/src/chmemheaps.c **** #define H_LOCK(h)       chMtxLock(&(h)->mtx)
  51:lib/chibios/os/oslib/src/chmemheaps.c **** #define H_UNLOCK(h)     chMtxUnlock(&(h)->mtx)
  52:lib/chibios/os/oslib/src/chmemheaps.c **** #else
  53:lib/chibios/os/oslib/src/chmemheaps.c **** #define H_LOCK(h)       (void) chSemWait(&(h)->sem)
  54:lib/chibios/os/oslib/src/chmemheaps.c **** #define H_UNLOCK(h)     chSemSignal(&(h)->sem)
  55:lib/chibios/os/oslib/src/chmemheaps.c **** #endif
  56:lib/chibios/os/oslib/src/chmemheaps.c **** 
  57:lib/chibios/os/oslib/src/chmemheaps.c **** #define H_BLOCK(hp)     ((hp) + 1U)
  58:lib/chibios/os/oslib/src/chmemheaps.c **** 
  59:lib/chibios/os/oslib/src/chmemheaps.c **** #define H_LIMIT(hp)     (H_BLOCK(hp) + H_PAGES(hp))
  60:lib/chibios/os/oslib/src/chmemheaps.c **** 
  61:lib/chibios/os/oslib/src/chmemheaps.c **** #define H_NEXT(hp)      ((hp)->free.next)
  62:lib/chibios/os/oslib/src/chmemheaps.c **** 
  63:lib/chibios/os/oslib/src/chmemheaps.c **** #define H_PAGES(hp)     ((hp)->free.pages)
  64:lib/chibios/os/oslib/src/chmemheaps.c **** 
  65:lib/chibios/os/oslib/src/chmemheaps.c **** #define H_HEAP(hp)      ((hp)->used.heap)
  66:lib/chibios/os/oslib/src/chmemheaps.c **** 
  67:lib/chibios/os/oslib/src/chmemheaps.c **** #define H_SIZE(hp)      ((hp)->used.size)
  68:lib/chibios/os/oslib/src/chmemheaps.c **** 
  69:lib/chibios/os/oslib/src/chmemheaps.c **** /*
  70:lib/chibios/os/oslib/src/chmemheaps.c ****  * Number of pages between two pointers in a MISRA-compatible way.
  71:lib/chibios/os/oslib/src/chmemheaps.c ****  */
  72:lib/chibios/os/oslib/src/chmemheaps.c **** #define NPAGES(p1, p2)                                                      \
  73:lib/chibios/os/oslib/src/chmemheaps.c ****   /*lint -save -e9033 [10.8] The cast is safe.*/                            \
  74:lib/chibios/os/oslib/src/chmemheaps.c ****   ((size_t)((p1) - (p2)))                                                   \
  75:lib/chibios/os/oslib/src/chmemheaps.c ****   /*lint -restore*/
  76:lib/chibios/os/oslib/src/chmemheaps.c **** 
  77:lib/chibios/os/oslib/src/chmemheaps.c **** /*===========================================================================*/
  78:lib/chibios/os/oslib/src/chmemheaps.c **** /* Module exported variables.                                                */
  79:lib/chibios/os/oslib/src/chmemheaps.c **** /*===========================================================================*/
  80:lib/chibios/os/oslib/src/chmemheaps.c **** 
  81:lib/chibios/os/oslib/src/chmemheaps.c **** /*===========================================================================*/
  82:lib/chibios/os/oslib/src/chmemheaps.c **** /* Module local types.                                                       */
  83:lib/chibios/os/oslib/src/chmemheaps.c **** /*===========================================================================*/
  84:lib/chibios/os/oslib/src/chmemheaps.c **** 
  85:lib/chibios/os/oslib/src/chmemheaps.c **** /*===========================================================================*/
  86:lib/chibios/os/oslib/src/chmemheaps.c **** /* Module local variables.                                                   */
  87:lib/chibios/os/oslib/src/chmemheaps.c **** /*===========================================================================*/
  88:lib/chibios/os/oslib/src/chmemheaps.c **** 
  89:lib/chibios/os/oslib/src/chmemheaps.c **** /**
  90:lib/chibios/os/oslib/src/chmemheaps.c ****  * @brief   Default heap descriptor.
  91:lib/chibios/os/oslib/src/chmemheaps.c ****  */
  92:lib/chibios/os/oslib/src/chmemheaps.c **** static memory_heap_t default_heap;
  93:lib/chibios/os/oslib/src/chmemheaps.c **** 
  94:lib/chibios/os/oslib/src/chmemheaps.c **** /*===========================================================================*/
  95:lib/chibios/os/oslib/src/chmemheaps.c **** /* Module local functions.                                                   */
  96:lib/chibios/os/oslib/src/chmemheaps.c **** /*===========================================================================*/
  97:lib/chibios/os/oslib/src/chmemheaps.c **** 
  98:lib/chibios/os/oslib/src/chmemheaps.c **** /*===========================================================================*/
  99:lib/chibios/os/oslib/src/chmemheaps.c **** /* Module exported functions.                                                */
 100:lib/chibios/os/oslib/src/chmemheaps.c **** /*===========================================================================*/
 101:lib/chibios/os/oslib/src/chmemheaps.c **** 
 102:lib/chibios/os/oslib/src/chmemheaps.c **** /**
 103:lib/chibios/os/oslib/src/chmemheaps.c ****  * @brief   Initializes the default heap.
 104:lib/chibios/os/oslib/src/chmemheaps.c ****  *
 105:lib/chibios/os/oslib/src/chmemheaps.c ****  * @notapi
 106:lib/chibios/os/oslib/src/chmemheaps.c ****  */
 107:lib/chibios/os/oslib/src/chmemheaps.c **** void _heap_init(void) {
  29              		.loc 1 107 23 view -0
  30              		.cfi_startproc
  31              		@ args = 0, pretend = 0, frame = 0
  32              		@ frame_needed = 0, uses_anonymous_args = 0
  33              		@ link register save eliminated.
 108:lib/chibios/os/oslib/src/chmemheaps.c **** 
 109:lib/chibios/os/oslib/src/chmemheaps.c ****   default_heap.provider = chCoreAllocAlignedWithOffset;
  34              		.loc 1 109 3 view .LVU1
  35              		.loc 1 109 25 is_stmt 0 view .LVU2
  36 0000 0448     		ldr	r0, .L2
  37 0002 054B     		ldr	r3, .L2+4
  38 0004 0360     		str	r3, [r0]
 110:lib/chibios/os/oslib/src/chmemheaps.c ****   H_NEXT(&default_heap.header) = NULL;
  39              		.loc 1 110 3 is_stmt 1 view .LVU3
  40              		.loc 1 110 32 is_stmt 0 view .LVU4
  41 0006 0023     		movs	r3, #0
 111:lib/chibios/os/oslib/src/chmemheaps.c ****   H_PAGES(&default_heap.header) = 0;
  42              		.loc 1 111 33 view .LVU5
  43 0008 C0E90133 		strd	r3, r3, [r0, #4]
 112:lib/chibios/os/oslib/src/chmemheaps.c **** #if (CH_CFG_USE_MUTEXES == TRUE) || defined(__DOXYGEN__)
 113:lib/chibios/os/oslib/src/chmemheaps.c ****   chMtxObjectInit(&default_heap.mtx);
  44              		.loc 1 113 3 is_stmt 1 view .LVU6
  45 000c 0C30     		adds	r0, r0, #12
  46 000e FFF7FEBF 		b	chMtxObjectInit
  47              	.LVL0:
  48              	.L3:
  49 0012 00BF     		.align	2
  50              	.L2:
  51 0014 00000000 		.word	.LANCHOR0
  52 0018 00000000 		.word	chCoreAllocFromTop
  53              		.cfi_endproc
  54              	.LFE289:
  56              		.section	.text.chHeapObjectInit,"ax",%progbits
  57              		.align	1
  58              		.global	chHeapObjectInit
  59              		.syntax unified
  60              		.thumb
  61              		.thumb_func
  62              		.fpu fpv4-sp-d16
  64              	chHeapObjectInit:
  65              	.LVL1:
  66              	.LFB290:
 114:lib/chibios/os/oslib/src/chmemheaps.c **** #else
 115:lib/chibios/os/oslib/src/chmemheaps.c ****   chSemObjectInit(&default_heap.sem, (cnt_t)1);
 116:lib/chibios/os/oslib/src/chmemheaps.c **** #endif
 117:lib/chibios/os/oslib/src/chmemheaps.c **** }
 118:lib/chibios/os/oslib/src/chmemheaps.c **** 
 119:lib/chibios/os/oslib/src/chmemheaps.c **** /**
 120:lib/chibios/os/oslib/src/chmemheaps.c ****  * @brief   Initializes a memory heap from a static memory area.
 121:lib/chibios/os/oslib/src/chmemheaps.c ****  * @note    The heap buffer base and size are adjusted if the passed buffer
 122:lib/chibios/os/oslib/src/chmemheaps.c ****  *          is not aligned to @p CH_HEAP_ALIGNMENT. This mean that the
 123:lib/chibios/os/oslib/src/chmemheaps.c ****  *          effective heap size can be less than @p size.
 124:lib/chibios/os/oslib/src/chmemheaps.c ****  *
 125:lib/chibios/os/oslib/src/chmemheaps.c ****  * @param[out] heapp    pointer to the memory heap descriptor to be initialized
 126:lib/chibios/os/oslib/src/chmemheaps.c ****  * @param[in] buf       heap buffer base
 127:lib/chibios/os/oslib/src/chmemheaps.c ****  * @param[in] size      heap size
 128:lib/chibios/os/oslib/src/chmemheaps.c ****  *
 129:lib/chibios/os/oslib/src/chmemheaps.c ****  * @init
 130:lib/chibios/os/oslib/src/chmemheaps.c ****  */
 131:lib/chibios/os/oslib/src/chmemheaps.c **** void chHeapObjectInit(memory_heap_t *heapp, void *buf, size_t size) {
  67              		.loc 1 131 69 view -0
  68              		.cfi_startproc
  69              		@ args = 0, pretend = 0, frame = 0
  70              		@ frame_needed = 0, uses_anonymous_args = 0
  71              		@ link register save eliminated.
 132:lib/chibios/os/oslib/src/chmemheaps.c ****   heap_header_t *hp = (heap_header_t *)MEM_ALIGN_NEXT(buf, CH_HEAP_ALIGNMENT);
  72              		.loc 1 132 3 view .LVU8
  73              		.loc 1 132 40 is_stmt 0 view .LVU9
  74 0000 CB1D     		adds	r3, r1, #7
  75 0002 23F00703 		bic	r3, r3, #7
  76              	.LVL2:
 133:lib/chibios/os/oslib/src/chmemheaps.c **** 
 134:lib/chibios/os/oslib/src/chmemheaps.c ****   chDbgCheck((heapp != NULL) && (size > 0U));
  77              		.loc 1 134 3 is_stmt 1 view .LVU10
  78              		.loc 1 134 3 view .LVU11
  79              		.loc 1 134 3 view .LVU12
 135:lib/chibios/os/oslib/src/chmemheaps.c **** 
 136:lib/chibios/os/oslib/src/chmemheaps.c ****   /* Adjusting the size in case the initial block was not correctly
 137:lib/chibios/os/oslib/src/chmemheaps.c ****      aligned.*/
 138:lib/chibios/os/oslib/src/chmemheaps.c ****   /*lint -save -e9033 [10.8] Required cast operations.*/
 139:lib/chibios/os/oslib/src/chmemheaps.c ****   size -= (size_t)((uint8_t *)hp - (uint8_t *)buf);
  80              		.loc 1 139 3 view .LVU13
 140:lib/chibios/os/oslib/src/chmemheaps.c ****   /*lint restore*/
 141:lib/chibios/os/oslib/src/chmemheaps.c **** 
 142:lib/chibios/os/oslib/src/chmemheaps.c ****   /* Initializing the heap header.*/
 143:lib/chibios/os/oslib/src/chmemheaps.c ****   heapp->provider = NULL;
  81              		.loc 1 143 3 view .LVU14
 144:lib/chibios/os/oslib/src/chmemheaps.c ****   H_NEXT(&heapp->header) = hp;
 145:lib/chibios/os/oslib/src/chmemheaps.c ****   H_PAGES(&heapp->header) = 0;
 146:lib/chibios/os/oslib/src/chmemheaps.c ****   H_NEXT(hp) = NULL;
 147:lib/chibios/os/oslib/src/chmemheaps.c ****   H_PAGES(hp) = (size - sizeof (heap_header_t)) / CH_HEAP_ALIGNMENT;
  82              		.loc 1 147 23 is_stmt 0 view .LVU15
  83 0006 083A     		subs	r2, r2, #8
  84              	.LVL3:
 139:lib/chibios/os/oslib/src/chmemheaps.c ****   /*lint restore*/
  85              		.loc 1 139 34 view .LVU16
  86 0008 591A     		subs	r1, r3, r1
  87              	.LVL4:
  88              		.loc 1 147 23 view .LVU17
  89 000a 521A     		subs	r2, r2, r1
  90              	.LVL5:
 131:lib/chibios/os/oslib/src/chmemheaps.c ****   heap_header_t *hp = (heap_header_t *)MEM_ALIGN_NEXT(buf, CH_HEAP_ALIGNMENT);
  91              		.loc 1 131 69 view .LVU18
  92 000c 10B4     		push	{r4}
  93              		.cfi_def_cfa_offset 4
  94              		.cfi_offset 4, -4
  95              		.loc 1 147 49 view .LVU19
  96 000e D208     		lsrs	r2, r2, #3
 143:lib/chibios/os/oslib/src/chmemheaps.c ****   H_NEXT(&heapp->header) = hp;
  97              		.loc 1 143 19 view .LVU20
  98 0010 0024     		movs	r4, #0
 144:lib/chibios/os/oslib/src/chmemheaps.c ****   H_PAGES(&heapp->header) = 0;
  99              		.loc 1 144 26 view .LVU21
 100 0012 C0E90043 		strd	r4, r3, [r0]
 145:lib/chibios/os/oslib/src/chmemheaps.c ****   H_NEXT(hp) = NULL;
 101              		.loc 1 145 3 is_stmt 1 view .LVU22
 145:lib/chibios/os/oslib/src/chmemheaps.c ****   H_NEXT(hp) = NULL;
 102              		.loc 1 145 27 is_stmt 0 view .LVU23
 103 0016 8460     		str	r4, [r0, #8]
 146:lib/chibios/os/oslib/src/chmemheaps.c ****   H_PAGES(hp) = (size - sizeof (heap_header_t)) / CH_HEAP_ALIGNMENT;
 104              		.loc 1 146 3 is_stmt 1 view .LVU24
 146:lib/chibios/os/oslib/src/chmemheaps.c ****   H_PAGES(hp) = (size - sizeof (heap_header_t)) / CH_HEAP_ALIGNMENT;
 105              		.loc 1 146 14 is_stmt 0 view .LVU25
 106 0018 1C60     		str	r4, [r3]
 107              		.loc 1 147 3 is_stmt 1 view .LVU26
 108              		.loc 1 147 15 is_stmt 0 view .LVU27
 109 001a 5A60     		str	r2, [r3, #4]
 148:lib/chibios/os/oslib/src/chmemheaps.c **** #if (CH_CFG_USE_MUTEXES == TRUE) || defined(__DOXYGEN__)
 149:lib/chibios/os/oslib/src/chmemheaps.c ****   chMtxObjectInit(&heapp->mtx);
 110              		.loc 1 149 3 is_stmt 1 view .LVU28
 150:lib/chibios/os/oslib/src/chmemheaps.c **** #else
 151:lib/chibios/os/oslib/src/chmemheaps.c ****   chSemObjectInit(&heapp->sem, (cnt_t)1);
 152:lib/chibios/os/oslib/src/chmemheaps.c **** #endif
 153:lib/chibios/os/oslib/src/chmemheaps.c **** }
 111              		.loc 1 153 1 is_stmt 0 view .LVU29
 112 001c 5DF8044B 		ldr	r4, [sp], #4
 113              		.cfi_restore 4
 114              		.cfi_def_cfa_offset 0
 149:lib/chibios/os/oslib/src/chmemheaps.c **** #else
 115              		.loc 1 149 3 view .LVU30
 116 0020 0C30     		adds	r0, r0, #12
 117              	.LVL6:
 149:lib/chibios/os/oslib/src/chmemheaps.c **** #else
 118              		.loc 1 149 3 view .LVU31
 119 0022 FFF7FEBF 		b	chMtxObjectInit
 120              	.LVL7:
 149:lib/chibios/os/oslib/src/chmemheaps.c **** #else
 121              		.loc 1 149 3 view .LVU32
 122              		.cfi_endproc
 123              	.LFE290:
 125              		.section	.text.chHeapAllocAligned,"ax",%progbits
 126              		.align	1
 127              		.global	chHeapAllocAligned
 128              		.syntax unified
 129              		.thumb
 130              		.thumb_func
 131              		.fpu fpv4-sp-d16
 133              	chHeapAllocAligned:
 134              	.LVL8:
 135              	.LFB291:
 154:lib/chibios/os/oslib/src/chmemheaps.c **** 
 155:lib/chibios/os/oslib/src/chmemheaps.c **** /**
 156:lib/chibios/os/oslib/src/chmemheaps.c ****  * @brief   Allocates a block of memory from the heap by using the first-fit
 157:lib/chibios/os/oslib/src/chmemheaps.c ****  *          algorithm.
 158:lib/chibios/os/oslib/src/chmemheaps.c ****  * @details The allocated block is guaranteed to be properly aligned to the
 159:lib/chibios/os/oslib/src/chmemheaps.c ****  *          specified alignment.
 160:lib/chibios/os/oslib/src/chmemheaps.c ****  *
 161:lib/chibios/os/oslib/src/chmemheaps.c ****  * @param[in] heapp     pointer to a heap descriptor or @p NULL in order to
 162:lib/chibios/os/oslib/src/chmemheaps.c ****  *                      access the default heap.
 163:lib/chibios/os/oslib/src/chmemheaps.c ****  * @param[in] size      the size of the block to be allocated. Note that the
 164:lib/chibios/os/oslib/src/chmemheaps.c ****  *                      allocated block may be a bit bigger than the requested
 165:lib/chibios/os/oslib/src/chmemheaps.c ****  *                      size for alignment and fragmentation reasons.
 166:lib/chibios/os/oslib/src/chmemheaps.c ****  * @param[in] align     desired memory alignment
 167:lib/chibios/os/oslib/src/chmemheaps.c ****  * @return              A pointer to the aligned allocated block.
 168:lib/chibios/os/oslib/src/chmemheaps.c ****  * @retval NULL         if the block cannot be allocated.
 169:lib/chibios/os/oslib/src/chmemheaps.c ****  *
 170:lib/chibios/os/oslib/src/chmemheaps.c ****  * @api
 171:lib/chibios/os/oslib/src/chmemheaps.c ****  */
 172:lib/chibios/os/oslib/src/chmemheaps.c **** void *chHeapAllocAligned(memory_heap_t *heapp, size_t size, unsigned align) {
 136              		.loc 1 172 77 is_stmt 1 view -0
 137              		.cfi_startproc
 138              		@ args = 0, pretend = 0, frame = 8
 139              		@ frame_needed = 0, uses_anonymous_args = 0
 173:lib/chibios/os/oslib/src/chmemheaps.c ****   heap_header_t *qp, *hp, *ahp;
 140              		.loc 1 173 3 view .LVU34
 174:lib/chibios/os/oslib/src/chmemheaps.c ****   size_t pages;
 141              		.loc 1 174 3 view .LVU35
 175:lib/chibios/os/oslib/src/chmemheaps.c **** 
 176:lib/chibios/os/oslib/src/chmemheaps.c ****   chDbgCheck((size > 0U) && MEM_IS_VALID_ALIGNMENT(align));
 142              		.loc 1 176 3 view .LVU36
 143              		.loc 1 176 3 view .LVU37
 144              		.loc 1 176 3 view .LVU38
 177:lib/chibios/os/oslib/src/chmemheaps.c **** 
 178:lib/chibios/os/oslib/src/chmemheaps.c ****   /* If an heap is not specified then the default system header is used.*/
 179:lib/chibios/os/oslib/src/chmemheaps.c ****   if (heapp == NULL) {
 145              		.loc 1 179 3 view .LVU39
 172:lib/chibios/os/oslib/src/chmemheaps.c ****   heap_header_t *qp, *hp, *ahp;
 146              		.loc 1 172 77 is_stmt 0 view .LVU40
 147 0000 2DE9F74F 		push	{r0, r1, r2, r4, r5, r6, r7, r8, r9, r10, fp, lr}
 148              		.cfi_def_cfa_offset 48
 149              		.cfi_offset 4, -36
 150              		.cfi_offset 5, -32
 151              		.cfi_offset 6, -28
 152              		.cfi_offset 7, -24
 153              		.cfi_offset 8, -20
 154              		.cfi_offset 9, -16
 155              		.cfi_offset 10, -12
 156              		.cfi_offset 11, -8
 157              		.cfi_offset 14, -4
 180:lib/chibios/os/oslib/src/chmemheaps.c ****     heapp = &default_heap;
 158              		.loc 1 180 11 view .LVU41
 159 0004 364F     		ldr	r7, .L21
 160 0006 0028     		cmp	r0, #0
 161 0008 18BF     		it	ne
 162 000a 0746     		movne	r7, r0
 163              	.LVL9:
 181:lib/chibios/os/oslib/src/chmemheaps.c ****   }
 182:lib/chibios/os/oslib/src/chmemheaps.c **** 
 183:lib/chibios/os/oslib/src/chmemheaps.c ****   /* Minimum alignment is constrained by the heap header structure size.*/
 184:lib/chibios/os/oslib/src/chmemheaps.c ****   if (align < CH_HEAP_ALIGNMENT) {
 164              		.loc 1 184 3 is_stmt 1 view .LVU42
 165 000c 082A     		cmp	r2, #8
 185:lib/chibios/os/oslib/src/chmemheaps.c ****     align = CH_HEAP_ALIGNMENT;
 186:lib/chibios/os/oslib/src/chmemheaps.c ****   }
 187:lib/chibios/os/oslib/src/chmemheaps.c **** 
 188:lib/chibios/os/oslib/src/chmemheaps.c ****   /* Size is converted in number of elementary allocation units.*/
 189:lib/chibios/os/oslib/src/chmemheaps.c ****   pages = MEM_ALIGN_NEXT(size, CH_HEAP_ALIGNMENT) / CH_HEAP_ALIGNMENT;
 190:lib/chibios/os/oslib/src/chmemheaps.c **** 
 191:lib/chibios/os/oslib/src/chmemheaps.c ****   /* Taking heap mutex/semaphore.*/
 192:lib/chibios/os/oslib/src/chmemheaps.c ****   H_LOCK(heapp);
 166              		.loc 1 192 3 is_stmt 0 view .LVU43
 167 000e 07F10C00 		add	r0, r7, #12
 168 0012 38BF     		it	cc
 169 0014 0822     		movcc	r2, #8
 170              	.LVL10:
 171              		.loc 1 192 3 view .LVU44
 172 0016 9146     		mov	r9, r2
 173              	.LVL11:
 189:lib/chibios/os/oslib/src/chmemheaps.c **** 
 174              		.loc 1 189 3 is_stmt 1 view .LVU45
 189:lib/chibios/os/oslib/src/chmemheaps.c **** 
 175              		.loc 1 189 11 is_stmt 0 view .LVU46
 176 0018 CD1D     		adds	r5, r1, #7
 172:lib/chibios/os/oslib/src/chmemheaps.c ****   heap_header_t *qp, *hp, *ahp;
 177              		.loc 1 172 77 view .LVU47
 178 001a 8846     		mov	r8, r1
 179              		.loc 1 192 3 view .LVU48
 180 001c 0190     		str	r0, [sp, #4]
 181 001e FFF7FEFF 		bl	chMtxLock
 182              	.LVL12:
 193:lib/chibios/os/oslib/src/chmemheaps.c **** 
 194:lib/chibios/os/oslib/src/chmemheaps.c ****   /* Start of the free blocks list.*/
 195:lib/chibios/os/oslib/src/chmemheaps.c ****   qp = &heapp->header;
 196:lib/chibios/os/oslib/src/chmemheaps.c ****   while (H_NEXT(qp) != NULL) {
 183              		.loc 1 196 9 view .LVU49
 184 0022 0198     		ldr	r0, [sp, #4]
 189:lib/chibios/os/oslib/src/chmemheaps.c **** 
 185              		.loc 1 189 9 view .LVU50
 186 0024 ED08     		lsrs	r5, r5, #3
 187              	.LVL13:
 192:lib/chibios/os/oslib/src/chmemheaps.c **** 
 188              		.loc 1 192 3 is_stmt 1 view .LVU51
 195:lib/chibios/os/oslib/src/chmemheaps.c ****   while (H_NEXT(qp) != NULL) {
 189              		.loc 1 195 3 view .LVU52
 195:lib/chibios/os/oslib/src/chmemheaps.c ****   while (H_NEXT(qp) != NULL) {
 190              		.loc 1 195 6 is_stmt 0 view .LVU53
 191 0026 3C1D     		adds	r4, r7, #4
 192              	.LVL14:
 193              		.loc 1 196 3 is_stmt 1 view .LVU54
 197:lib/chibios/os/oslib/src/chmemheaps.c **** 
 198:lib/chibios/os/oslib/src/chmemheaps.c ****     /* Next free block.*/
 199:lib/chibios/os/oslib/src/chmemheaps.c ****     hp = H_NEXT(qp);
 200:lib/chibios/os/oslib/src/chmemheaps.c **** 
 201:lib/chibios/os/oslib/src/chmemheaps.c ****     /* Pointer aligned to the requested alignment.*/
 202:lib/chibios/os/oslib/src/chmemheaps.c ****     ahp = (heap_header_t *)MEM_ALIGN_NEXT(H_BLOCK(hp), align) - 1U;
 194              		.loc 1 202 28 is_stmt 0 view .LVU55
 195 0028 09F10701 		add	r1, r9, #7
 196 002c C9F1000E 		rsb	lr, r9, #0
 197              	.LVL15:
 198              	.L17:
 196:lib/chibios/os/oslib/src/chmemheaps.c **** 
 199              		.loc 1 196 21 is_stmt 1 view .LVU56
 200 0030 2246     		mov	r2, r4
 196:lib/chibios/os/oslib/src/chmemheaps.c **** 
 201              		.loc 1 196 10 is_stmt 0 view .LVU57
 202 0032 2468     		ldr	r4, [r4]
 203              	.LVL16:
 196:lib/chibios/os/oslib/src/chmemheaps.c **** 
 204              		.loc 1 196 21 view .LVU58
 205 0034 64B9     		cbnz	r4, .L12
 203:lib/chibios/os/oslib/src/chmemheaps.c **** 
 204:lib/chibios/os/oslib/src/chmemheaps.c ****     if ((ahp < H_LIMIT(hp)) && (pages <= NPAGES(H_LIMIT(hp), ahp + 1U))) {
 205:lib/chibios/os/oslib/src/chmemheaps.c ****       /* The block is large enough to contain a correctly aligned area
 206:lib/chibios/os/oslib/src/chmemheaps.c ****          of sufficient size.*/
 207:lib/chibios/os/oslib/src/chmemheaps.c **** 
 208:lib/chibios/os/oslib/src/chmemheaps.c ****       if (ahp > hp) {
 209:lib/chibios/os/oslib/src/chmemheaps.c ****         /* The block is not properly aligned, must split it.*/
 210:lib/chibios/os/oslib/src/chmemheaps.c ****         size_t bpages;
 211:lib/chibios/os/oslib/src/chmemheaps.c **** 
 212:lib/chibios/os/oslib/src/chmemheaps.c ****         bpages = NPAGES(H_LIMIT(hp), H_BLOCK(ahp));
 213:lib/chibios/os/oslib/src/chmemheaps.c ****         H_PAGES(hp) = NPAGES(ahp, H_BLOCK(hp));
 214:lib/chibios/os/oslib/src/chmemheaps.c ****         if (bpages > pages) {
 215:lib/chibios/os/oslib/src/chmemheaps.c ****           /* The block is bigger than required, must split the excess.*/
 216:lib/chibios/os/oslib/src/chmemheaps.c ****           heap_header_t *fp;
 217:lib/chibios/os/oslib/src/chmemheaps.c **** 
 218:lib/chibios/os/oslib/src/chmemheaps.c ****           /* Creating the excess block.*/
 219:lib/chibios/os/oslib/src/chmemheaps.c ****           fp = H_BLOCK(ahp) + pages;
 220:lib/chibios/os/oslib/src/chmemheaps.c ****           H_PAGES(fp) = (bpages - pages) - 1U;
 221:lib/chibios/os/oslib/src/chmemheaps.c **** 
 222:lib/chibios/os/oslib/src/chmemheaps.c ****           /* Linking the excess block.*/
 223:lib/chibios/os/oslib/src/chmemheaps.c ****           H_NEXT(fp) = H_NEXT(hp);
 224:lib/chibios/os/oslib/src/chmemheaps.c ****           H_NEXT(hp) = fp;
 225:lib/chibios/os/oslib/src/chmemheaps.c ****         }
 226:lib/chibios/os/oslib/src/chmemheaps.c **** 
 227:lib/chibios/os/oslib/src/chmemheaps.c ****         hp = ahp;
 228:lib/chibios/os/oslib/src/chmemheaps.c ****       }
 229:lib/chibios/os/oslib/src/chmemheaps.c ****       else {
 230:lib/chibios/os/oslib/src/chmemheaps.c ****         /* The block is already properly aligned.*/
 231:lib/chibios/os/oslib/src/chmemheaps.c **** 
 232:lib/chibios/os/oslib/src/chmemheaps.c ****         if (H_PAGES(hp) == pages) {
 233:lib/chibios/os/oslib/src/chmemheaps.c ****           /* Exact size, getting the whole block.*/
 234:lib/chibios/os/oslib/src/chmemheaps.c ****           H_NEXT(qp) = H_NEXT(hp);
 235:lib/chibios/os/oslib/src/chmemheaps.c ****         }
 236:lib/chibios/os/oslib/src/chmemheaps.c ****         else {
 237:lib/chibios/os/oslib/src/chmemheaps.c ****           /* The block is bigger than required, must split the excess.*/
 238:lib/chibios/os/oslib/src/chmemheaps.c ****           heap_header_t *fp;
 239:lib/chibios/os/oslib/src/chmemheaps.c **** 
 240:lib/chibios/os/oslib/src/chmemheaps.c ****           fp = H_BLOCK(hp) + pages;
 241:lib/chibios/os/oslib/src/chmemheaps.c ****           H_NEXT(fp) = H_NEXT(hp);
 242:lib/chibios/os/oslib/src/chmemheaps.c ****           H_PAGES(fp) = NPAGES(H_LIMIT(hp), H_BLOCK(fp));
 243:lib/chibios/os/oslib/src/chmemheaps.c ****           H_NEXT(qp) = fp;
 244:lib/chibios/os/oslib/src/chmemheaps.c ****         }
 245:lib/chibios/os/oslib/src/chmemheaps.c ****       }
 246:lib/chibios/os/oslib/src/chmemheaps.c **** 
 247:lib/chibios/os/oslib/src/chmemheaps.c ****       /* Setting in the block owner heap and size.*/
 248:lib/chibios/os/oslib/src/chmemheaps.c ****       H_SIZE(hp) = size;
 249:lib/chibios/os/oslib/src/chmemheaps.c ****       H_HEAP(hp) = heapp;
 250:lib/chibios/os/oslib/src/chmemheaps.c **** 
 251:lib/chibios/os/oslib/src/chmemheaps.c ****       /* Releasing heap mutex/semaphore.*/
 252:lib/chibios/os/oslib/src/chmemheaps.c ****       H_UNLOCK(heapp);
 253:lib/chibios/os/oslib/src/chmemheaps.c **** 
 254:lib/chibios/os/oslib/src/chmemheaps.c ****       /*lint -save -e9087 [11.3] Safe cast.*/
 255:lib/chibios/os/oslib/src/chmemheaps.c ****       return (void *)H_BLOCK(hp);
 256:lib/chibios/os/oslib/src/chmemheaps.c ****       /*lint -restore*/
 257:lib/chibios/os/oslib/src/chmemheaps.c ****     }
 258:lib/chibios/os/oslib/src/chmemheaps.c **** 
 259:lib/chibios/os/oslib/src/chmemheaps.c ****     /* Next in the free blocks list.*/
 260:lib/chibios/os/oslib/src/chmemheaps.c ****     qp = hp;
 261:lib/chibios/os/oslib/src/chmemheaps.c ****   }
 262:lib/chibios/os/oslib/src/chmemheaps.c **** 
 263:lib/chibios/os/oslib/src/chmemheaps.c ****   /* Releasing heap mutex/semaphore.*/
 264:lib/chibios/os/oslib/src/chmemheaps.c ****   H_UNLOCK(heapp);
 206              		.loc 1 264 3 is_stmt 1 view .LVU59
 207 0036 FFF7FEFF 		bl	chMtxUnlock
 208              	.LVL17:
 265:lib/chibios/os/oslib/src/chmemheaps.c **** 
 266:lib/chibios/os/oslib/src/chmemheaps.c ****   /* More memory is required, tries to get it from the associated provider
 267:lib/chibios/os/oslib/src/chmemheaps.c ****      else fails.*/
 268:lib/chibios/os/oslib/src/chmemheaps.c ****   if (heapp->provider != NULL) {
 209              		.loc 1 268 3 view .LVU60
 210              		.loc 1 268 12 is_stmt 0 view .LVU61
 211 003a 3B68     		ldr	r3, [r7]
 212              		.loc 1 268 6 view .LVU62
 213 003c CBB3     		cbz	r3, .L5
 269:lib/chibios/os/oslib/src/chmemheaps.c ****     ahp = heapp->provider(pages * CH_HEAP_ALIGNMENT,
 214              		.loc 1 269 5 is_stmt 1 view .LVU63
 215              		.loc 1 269 11 is_stmt 0 view .LVU64
 216 003e 0822     		movs	r2, #8
 217 0040 4946     		mov	r1, r9
 218 0042 E800     		lsls	r0, r5, #3
 219 0044 9847     		blx	r3
 220              	.LVL18:
 270:lib/chibios/os/oslib/src/chmemheaps.c ****                           align,
 271:lib/chibios/os/oslib/src/chmemheaps.c ****                           sizeof (heap_header_t));
 272:lib/chibios/os/oslib/src/chmemheaps.c ****     if (ahp != NULL) {
 221              		.loc 1 272 5 is_stmt 1 view .LVU65
 222              		.loc 1 272 8 is_stmt 0 view .LVU66
 223 0046 0446     		mov	r4, r0
 224 0048 98B3     		cbz	r0, .L5
 273:lib/chibios/os/oslib/src/chmemheaps.c ****       hp = ahp - 1U;
 225              		.loc 1 273 7 is_stmt 1 view .LVU67
 226              	.LVL19:
 274:lib/chibios/os/oslib/src/chmemheaps.c ****       H_HEAP(hp) = heapp;
 227              		.loc 1 274 7 view .LVU68
 275:lib/chibios/os/oslib/src/chmemheaps.c ****       H_SIZE(hp) = size;
 228              		.loc 1 275 18 is_stmt 0 view .LVU69
 229 004a 40E90278 		strd	r7, r8, [r0, #-8]
 276:lib/chibios/os/oslib/src/chmemheaps.c **** 
 277:lib/chibios/os/oslib/src/chmemheaps.c ****       /*lint -save -e9087 [11.3] Safe cast.*/
 278:lib/chibios/os/oslib/src/chmemheaps.c ****       return (void *)ahp;
 230              		.loc 1 278 7 is_stmt 1 view .LVU70
 231              		.loc 1 278 14 is_stmt 0 view .LVU71
 232 004e 30E0     		b	.L5
 233              	.LVL20:
 234              	.L12:
 199:lib/chibios/os/oslib/src/chmemheaps.c **** 
 235              		.loc 1 199 5 is_stmt 1 view .LVU72
 202:lib/chibios/os/oslib/src/chmemheaps.c **** 
 236              		.loc 1 202 5 view .LVU73
 204:lib/chibios/os/oslib/src/chmemheaps.c ****       /* The block is large enough to contain a correctly aligned area
 237              		.loc 1 204 16 is_stmt 0 view .LVU74
 238 0050 D4F804A0 		ldr	r10, [r4, #4]
 202:lib/chibios/os/oslib/src/chmemheaps.c **** 
 239              		.loc 1 202 28 view .LVU75
 240 0054 04EB010C 		add	ip, r4, r1
 241 0058 0CEA0E0C 		and	ip, ip, lr
 204:lib/chibios/os/oslib/src/chmemheaps.c ****       /* The block is large enough to contain a correctly aligned area
 242              		.loc 1 204 16 view .LVU76
 243 005c 0AF10106 		add	r6, r10, #1
 202:lib/chibios/os/oslib/src/chmemheaps.c **** 
 244              		.loc 1 202 63 view .LVU77
 245 0060 ACF10803 		sub	r3, ip, #8
 246              	.LVL21:
 204:lib/chibios/os/oslib/src/chmemheaps.c ****       /* The block is large enough to contain a correctly aligned area
 247              		.loc 1 204 5 is_stmt 1 view .LVU78
 204:lib/chibios/os/oslib/src/chmemheaps.c ****       /* The block is large enough to contain a correctly aligned area
 248              		.loc 1 204 16 is_stmt 0 view .LVU79
 249 0064 04EBC606 		add	r6, r4, r6, lsl #3
 204:lib/chibios/os/oslib/src/chmemheaps.c ****       /* The block is large enough to contain a correctly aligned area
 250              		.loc 1 204 8 view .LVU80
 251 0068 9E42     		cmp	r6, r3
 252 006a E1D9     		bls	.L17
 204:lib/chibios/os/oslib/src/chmemheaps.c ****       /* The block is large enough to contain a correctly aligned area
 253              		.loc 1 204 42 discriminator 1 view .LVU81
 254 006c A6EB0C0C 		sub	ip, r6, ip
 204:lib/chibios/os/oslib/src/chmemheaps.c ****       /* The block is large enough to contain a correctly aligned area
 255              		.loc 1 204 29 discriminator 1 view .LVU82
 256 0070 B5EBEC0F 		cmp	r5, ip, asr #3
 204:lib/chibios/os/oslib/src/chmemheaps.c ****       /* The block is large enough to contain a correctly aligned area
 257              		.loc 1 204 42 discriminator 1 view .LVU83
 258 0074 4FEAEC0B 		asr	fp, ip, #3
 204:lib/chibios/os/oslib/src/chmemheaps.c ****       /* The block is large enough to contain a correctly aligned area
 259              		.loc 1 204 29 discriminator 1 view .LVU84
 260 0078 DAD8     		bhi	.L17
 208:lib/chibios/os/oslib/src/chmemheaps.c ****         /* The block is not properly aligned, must split it.*/
 261              		.loc 1 208 7 is_stmt 1 view .LVU85
 208:lib/chibios/os/oslib/src/chmemheaps.c ****         /* The block is not properly aligned, must split it.*/
 262              		.loc 1 208 10 is_stmt 0 view .LVU86
 263 007a 9C42     		cmp	r4, r3
 264 007c 1DD2     		bcs	.L8
 265              	.LBB2:
 210:lib/chibios/os/oslib/src/chmemheaps.c **** 
 266              		.loc 1 210 9 is_stmt 1 view .LVU87
 212:lib/chibios/os/oslib/src/chmemheaps.c ****         H_PAGES(hp) = NPAGES(ahp, H_BLOCK(hp));
 267              		.loc 1 212 9 view .LVU88
 268              	.LVL22:
 213:lib/chibios/os/oslib/src/chmemheaps.c ****         if (bpages > pages) {
 269              		.loc 1 213 9 view .LVU89
 213:lib/chibios/os/oslib/src/chmemheaps.c ****         if (bpages > pages) {
 270              		.loc 1 213 23 is_stmt 0 view .LVU90
 271 007e 04F10802 		add	r2, r4, #8
 272              	.LVL23:
 213:lib/chibios/os/oslib/src/chmemheaps.c ****         if (bpages > pages) {
 273              		.loc 1 213 23 view .LVU91
 274 0082 9A1A     		subs	r2, r3, r2
 275 0084 D210     		asrs	r2, r2, #3
 214:lib/chibios/os/oslib/src/chmemheaps.c ****           /* The block is bigger than required, must split the excess.*/
 276              		.loc 1 214 12 view .LVU92
 277 0086 AB45     		cmp	fp, r5
 213:lib/chibios/os/oslib/src/chmemheaps.c ****         if (bpages > pages) {
 278              		.loc 1 213 21 view .LVU93
 279 0088 6260     		str	r2, [r4, #4]
 214:lib/chibios/os/oslib/src/chmemheaps.c ****           /* The block is bigger than required, must split the excess.*/
 280              		.loc 1 214 9 is_stmt 1 view .LVU94
 214:lib/chibios/os/oslib/src/chmemheaps.c ****           /* The block is bigger than required, must split the excess.*/
 281              		.loc 1 214 12 is_stmt 0 view .LVU95
 282 008a 0BD9     		bls	.L9
 283              	.LBB3:
 216:lib/chibios/os/oslib/src/chmemheaps.c **** 
 284              		.loc 1 216 11 is_stmt 1 view .LVU96
 219:lib/chibios/os/oslib/src/chmemheaps.c ****           H_PAGES(fp) = (bpages - pages) - 1U;
 285              		.loc 1 219 11 view .LVU97
 219:lib/chibios/os/oslib/src/chmemheaps.c ****           H_PAGES(fp) = (bpages - pages) - 1U;
 286              		.loc 1 219 29 is_stmt 0 view .LVU98
 287 008c 6E1C     		adds	r6, r5, #1
 219:lib/chibios/os/oslib/src/chmemheaps.c ****           H_PAGES(fp) = (bpages - pages) - 1U;
 288              		.loc 1 219 14 view .LVU99
 289 008e 03EBC601 		add	r1, r3, r6, lsl #3
 290              	.LVL24:
 220:lib/chibios/os/oslib/src/chmemheaps.c **** 
 291              		.loc 1 220 11 is_stmt 1 view .LVU100
 220:lib/chibios/os/oslib/src/chmemheaps.c **** 
 292              		.loc 1 220 42 is_stmt 0 view .LVU101
 293 0092 ABEB050B 		sub	fp, fp, r5
 294              	.LVL25:
 220:lib/chibios/os/oslib/src/chmemheaps.c **** 
 295              		.loc 1 220 42 view .LVU102
 296 0096 0BF1FF32 		add	r2, fp, #-1
 220:lib/chibios/os/oslib/src/chmemheaps.c **** 
 297              		.loc 1 220 23 view .LVU103
 298 009a 4A60     		str	r2, [r1, #4]
 223:lib/chibios/os/oslib/src/chmemheaps.c ****           H_NEXT(hp) = fp;
 299              		.loc 1 223 11 is_stmt 1 view .LVU104
 223:lib/chibios/os/oslib/src/chmemheaps.c ****           H_NEXT(hp) = fp;
 300              		.loc 1 223 24 is_stmt 0 view .LVU105
 301 009c 2268     		ldr	r2, [r4]
 223:lib/chibios/os/oslib/src/chmemheaps.c ****           H_NEXT(hp) = fp;
 302              		.loc 1 223 22 view .LVU106
 303 009e 43F83620 		str	r2, [r3, r6, lsl #3]
 224:lib/chibios/os/oslib/src/chmemheaps.c ****         }
 304              		.loc 1 224 11 is_stmt 1 view .LVU107
 224:lib/chibios/os/oslib/src/chmemheaps.c ****         }
 305              		.loc 1 224 22 is_stmt 0 view .LVU108
 306 00a2 2160     		str	r1, [r4]
 307              	.LVL26:
 308              	.L9:
 224:lib/chibios/os/oslib/src/chmemheaps.c ****         }
 309              		.loc 1 224 22 view .LVU109
 310              	.LBE3:
 311              	.LBE2:
 248:lib/chibios/os/oslib/src/chmemheaps.c ****       H_HEAP(hp) = heapp;
 312              		.loc 1 248 7 is_stmt 1 view .LVU110
 249:lib/chibios/os/oslib/src/chmemheaps.c **** 
 313              		.loc 1 249 18 is_stmt 0 view .LVU111
 314 00a4 1C46     		mov	r4, r3
 315              	.LVL27:
 248:lib/chibios/os/oslib/src/chmemheaps.c ****       H_HEAP(hp) = heapp;
 316              		.loc 1 248 18 view .LVU112
 317 00a6 C3F80480 		str	r8, [r3, #4]
 249:lib/chibios/os/oslib/src/chmemheaps.c **** 
 318              		.loc 1 249 7 is_stmt 1 view .LVU113
 249:lib/chibios/os/oslib/src/chmemheaps.c **** 
 319              		.loc 1 249 18 is_stmt 0 view .LVU114
 320 00aa 44F8087B 		str	r7, [r4], #8
 252:lib/chibios/os/oslib/src/chmemheaps.c **** 
 321              		.loc 1 252 7 is_stmt 1 view .LVU115
 322 00ae FFF7FEFF 		bl	chMtxUnlock
 323              	.LVL28:
 255:lib/chibios/os/oslib/src/chmemheaps.c ****       /*lint -restore*/
 324              		.loc 1 255 7 view .LVU116
 325              	.L5:
 279:lib/chibios/os/oslib/src/chmemheaps.c ****       /*lint -restore*/
 280:lib/chibios/os/oslib/src/chmemheaps.c ****     }
 281:lib/chibios/os/oslib/src/chmemheaps.c ****   }
 282:lib/chibios/os/oslib/src/chmemheaps.c **** 
 283:lib/chibios/os/oslib/src/chmemheaps.c ****   return NULL;
 284:lib/chibios/os/oslib/src/chmemheaps.c **** }
 326              		.loc 1 284 1 is_stmt 0 view .LVU117
 327 00b2 2046     		mov	r0, r4
 328 00b4 03B0     		add	sp, sp, #12
 329              		.cfi_remember_state
 330              		.cfi_def_cfa_offset 36
 331              		@ sp needed
 332 00b6 BDE8F08F 		pop	{r4, r5, r6, r7, r8, r9, r10, fp, pc}
 333              	.LVL29:
 334              	.L8:
 335              		.cfi_restore_state
 232:lib/chibios/os/oslib/src/chmemheaps.c ****           /* Exact size, getting the whole block.*/
 336              		.loc 1 232 9 is_stmt 1 view .LVU118
 232:lib/chibios/os/oslib/src/chmemheaps.c ****           /* Exact size, getting the whole block.*/
 337              		.loc 1 232 12 is_stmt 0 view .LVU119
 338 00ba AA45     		cmp	r10, r5
 339              	.LBB5:
 340              	.LBB4:
 223:lib/chibios/os/oslib/src/chmemheaps.c ****           H_NEXT(hp) = fp;
 341              		.loc 1 223 24 view .LVU120
 342 00bc 2168     		ldr	r1, [r4]
 343              	.LBE4:
 344              	.LBE5:
 232:lib/chibios/os/oslib/src/chmemheaps.c ****           /* Exact size, getting the whole block.*/
 345              		.loc 1 232 12 view .LVU121
 346 00be 02D1     		bne	.L10
 234:lib/chibios/os/oslib/src/chmemheaps.c ****         }
 347              		.loc 1 234 11 is_stmt 1 view .LVU122
 234:lib/chibios/os/oslib/src/chmemheaps.c ****         }
 348              		.loc 1 234 22 is_stmt 0 view .LVU123
 349 00c0 1160     		str	r1, [r2]
 350              	.LVL30:
 351              	.L20:
 352              	.LBB6:
 243:lib/chibios/os/oslib/src/chmemheaps.c ****         }
 353              		.loc 1 243 22 view .LVU124
 354 00c2 2346     		mov	r3, r4
 355 00c4 EEE7     		b	.L9
 356              	.LVL31:
 357              	.L10:
 238:lib/chibios/os/oslib/src/chmemheaps.c **** 
 358              		.loc 1 238 11 is_stmt 1 view .LVU125
 240:lib/chibios/os/oslib/src/chmemheaps.c ****           H_NEXT(fp) = H_NEXT(hp);
 359              		.loc 1 240 11 view .LVU126
 240:lib/chibios/os/oslib/src/chmemheaps.c ****           H_NEXT(fp) = H_NEXT(hp);
 360              		.loc 1 240 28 is_stmt 0 view .LVU127
 361 00c6 0135     		adds	r5, r5, #1
 362              	.LVL32:
 240:lib/chibios/os/oslib/src/chmemheaps.c ****           H_NEXT(fp) = H_NEXT(hp);
 363              		.loc 1 240 14 view .LVU128
 364 00c8 04EBC503 		add	r3, r4, r5, lsl #3
 365              	.LVL33:
 241:lib/chibios/os/oslib/src/chmemheaps.c ****           H_PAGES(fp) = NPAGES(H_LIMIT(hp), H_BLOCK(fp));
 366              		.loc 1 241 11 is_stmt 1 view .LVU129
 241:lib/chibios/os/oslib/src/chmemheaps.c ****           H_PAGES(fp) = NPAGES(H_LIMIT(hp), H_BLOCK(fp));
 367              		.loc 1 241 22 is_stmt 0 view .LVU130
 368 00cc 44F83510 		str	r1, [r4, r5, lsl #3]
 242:lib/chibios/os/oslib/src/chmemheaps.c ****           H_NEXT(qp) = fp;
 369              		.loc 1 242 11 is_stmt 1 view .LVU131
 242:lib/chibios/os/oslib/src/chmemheaps.c ****           H_NEXT(qp) = fp;
 370              		.loc 1 242 25 is_stmt 0 view .LVU132
 371 00d0 03F10801 		add	r1, r3, #8
 372 00d4 761A     		subs	r6, r6, r1
 373 00d6 F610     		asrs	r6, r6, #3
 242:lib/chibios/os/oslib/src/chmemheaps.c ****           H_NEXT(qp) = fp;
 374              		.loc 1 242 23 view .LVU133
 375 00d8 5E60     		str	r6, [r3, #4]
 243:lib/chibios/os/oslib/src/chmemheaps.c ****         }
 376              		.loc 1 243 11 is_stmt 1 view .LVU134
 243:lib/chibios/os/oslib/src/chmemheaps.c ****         }
 377              		.loc 1 243 22 is_stmt 0 view .LVU135
 378 00da 1360     		str	r3, [r2]
 379 00dc F1E7     		b	.L20
 380              	.L22:
 381 00de 00BF     		.align	2
 382              	.L21:
 383 00e0 00000000 		.word	.LANCHOR0
 384              	.LBE6:
 385              		.cfi_endproc
 386              	.LFE291:
 388              		.section	.text.chHeapFree,"ax",%progbits
 389              		.align	1
 390              		.global	chHeapFree
 391              		.syntax unified
 392              		.thumb
 393              		.thumb_func
 394              		.fpu fpv4-sp-d16
 396              	chHeapFree:
 397              	.LVL34:
 398              	.LFB292:
 285:lib/chibios/os/oslib/src/chmemheaps.c **** 
 286:lib/chibios/os/oslib/src/chmemheaps.c **** /**
 287:lib/chibios/os/oslib/src/chmemheaps.c ****  * @brief   Frees a previously allocated memory block.
 288:lib/chibios/os/oslib/src/chmemheaps.c ****  *
 289:lib/chibios/os/oslib/src/chmemheaps.c ****  * @param[in] p         pointer to the memory block to be freed
 290:lib/chibios/os/oslib/src/chmemheaps.c ****  *
 291:lib/chibios/os/oslib/src/chmemheaps.c ****  * @api
 292:lib/chibios/os/oslib/src/chmemheaps.c ****  */
 293:lib/chibios/os/oslib/src/chmemheaps.c **** void chHeapFree(void *p) {
 399              		.loc 1 293 26 is_stmt 1 view -0
 400              		.cfi_startproc
 401              		@ args = 0, pretend = 0, frame = 8
 402              		@ frame_needed = 0, uses_anonymous_args = 0
 294:lib/chibios/os/oslib/src/chmemheaps.c ****   heap_header_t *qp, *hp;
 403              		.loc 1 294 3 view .LVU137
 295:lib/chibios/os/oslib/src/chmemheaps.c ****   memory_heap_t *heapp;
 404              		.loc 1 295 3 view .LVU138
 296:lib/chibios/os/oslib/src/chmemheaps.c **** 
 297:lib/chibios/os/oslib/src/chmemheaps.c ****   chDbgCheck((p != NULL) && MEM_IS_ALIGNED(p, CH_HEAP_ALIGNMENT));
 405              		.loc 1 297 3 view .LVU139
 406              		.loc 1 297 3 view .LVU140
 407              		.loc 1 297 3 view .LVU141
 298:lib/chibios/os/oslib/src/chmemheaps.c **** 
 299:lib/chibios/os/oslib/src/chmemheaps.c ****   /*lint -save -e9087 [11.3] Safe cast.*/
 300:lib/chibios/os/oslib/src/chmemheaps.c ****   hp = (heap_header_t *)p - 1U;
 408              		.loc 1 300 3 view .LVU142
 293:lib/chibios/os/oslib/src/chmemheaps.c ****   heap_header_t *qp, *hp;
 409              		.loc 1 293 26 is_stmt 0 view .LVU143
 410 0000 73B5     		push	{r0, r1, r4, r5, r6, lr}
 411              		.cfi_def_cfa_offset 24
 412              		.cfi_offset 4, -16
 413              		.cfi_offset 5, -12
 414              		.cfi_offset 6, -8
 415              		.cfi_offset 14, -4
 293:lib/chibios/os/oslib/src/chmemheaps.c ****   heap_header_t *qp, *hp;
 416              		.loc 1 293 26 view .LVU144
 417 0002 0446     		mov	r4, r0
 418              		.loc 1 300 6 view .LVU145
 419 0004 A0F10805 		sub	r5, r0, #8
 420              	.LVL35:
 301:lib/chibios/os/oslib/src/chmemheaps.c ****   /*lint -restore*/
 302:lib/chibios/os/oslib/src/chmemheaps.c ****   heapp = H_HEAP(hp);
 421              		.loc 1 302 3 is_stmt 1 view .LVU146
 303:lib/chibios/os/oslib/src/chmemheaps.c ****   qp = &heapp->header;
 304:lib/chibios/os/oslib/src/chmemheaps.c **** 
 305:lib/chibios/os/oslib/src/chmemheaps.c ****   /* Size is converted in number of elementary allocation units.*/
 306:lib/chibios/os/oslib/src/chmemheaps.c ****   H_PAGES(hp) = MEM_ALIGN_NEXT(H_SIZE(hp),
 422              		.loc 1 306 17 is_stmt 0 view .LVU147
 423 0008 54F8043C 		ldr	r3, [r4, #-4]
 302:lib/chibios/os/oslib/src/chmemheaps.c ****   qp = &heapp->header;
 424              		.loc 1 302 9 view .LVU148
 425 000c 50F8080C 		ldr	r0, [r0, #-8]
 426              	.LVL36:
 303:lib/chibios/os/oslib/src/chmemheaps.c ****   qp = &heapp->header;
 427              		.loc 1 303 3 is_stmt 1 view .LVU149
 428              		.loc 1 306 17 is_stmt 0 view .LVU150
 429 0010 0733     		adds	r3, r3, #7
 307:lib/chibios/os/oslib/src/chmemheaps.c ****                                CH_HEAP_ALIGNMENT) / CH_HEAP_ALIGNMENT;
 430              		.loc 1 307 51 view .LVU151
 431 0012 DB08     		lsrs	r3, r3, #3
 303:lib/chibios/os/oslib/src/chmemheaps.c ****   qp = &heapp->header;
 432              		.loc 1 303 6 view .LVU152
 433 0014 061D     		adds	r6, r0, #4
 434              	.LVL37:
 306:lib/chibios/os/oslib/src/chmemheaps.c ****                                CH_HEAP_ALIGNMENT) / CH_HEAP_ALIGNMENT;
 435              		.loc 1 306 3 is_stmt 1 view .LVU153
 306:lib/chibios/os/oslib/src/chmemheaps.c ****                                CH_HEAP_ALIGNMENT) / CH_HEAP_ALIGNMENT;
 436              		.loc 1 306 15 is_stmt 0 view .LVU154
 437 0016 44F8043C 		str	r3, [r4, #-4]
 308:lib/chibios/os/oslib/src/chmemheaps.c **** 
 309:lib/chibios/os/oslib/src/chmemheaps.c ****   /* Taking heap mutex/semaphore.*/
 310:lib/chibios/os/oslib/src/chmemheaps.c ****   H_LOCK(heapp);
 438              		.loc 1 310 3 is_stmt 1 view .LVU155
 439 001a 0C30     		adds	r0, r0, #12
 440              	.LVL38:
 441              		.loc 1 310 3 is_stmt 0 view .LVU156
 442 001c 0190     		str	r0, [sp, #4]
 443 001e FFF7FEFF 		bl	chMtxLock
 444              	.LVL39:
 303:lib/chibios/os/oslib/src/chmemheaps.c **** 
 445              		.loc 1 303 6 view .LVU157
 446 0022 0198     		ldr	r0, [sp, #4]
 447 0024 3346     		mov	r3, r6
 448              	.LVL40:
 449              	.L29:
 311:lib/chibios/os/oslib/src/chmemheaps.c **** 
 312:lib/chibios/os/oslib/src/chmemheaps.c ****   while (true) {
 450              		.loc 1 312 3 is_stmt 1 discriminator 7 view .LVU158
 313:lib/chibios/os/oslib/src/chmemheaps.c ****     chDbgAssert((hp < qp) || (hp >= H_LIMIT(qp)), "within free block");
 451              		.loc 1 313 5 discriminator 7 view .LVU159
 452              		.loc 1 313 5 discriminator 7 view .LVU160
 453              		.loc 1 313 5 discriminator 7 view .LVU161
 314:lib/chibios/os/oslib/src/chmemheaps.c **** 
 315:lib/chibios/os/oslib/src/chmemheaps.c ****     if (((qp == &heapp->header) || (hp > qp)) &&
 454              		.loc 1 315 5 discriminator 7 view .LVU162
 455              		.loc 1 315 8 is_stmt 0 discriminator 7 view .LVU163
 456 0026 B342     		cmp	r3, r6
 457 0028 1A68     		ldr	r2, [r3]
 458 002a 01D0     		beq	.L24
 459              		.loc 1 315 33 discriminator 2 view .LVU164
 460 002c 9D42     		cmp	r5, r3
 461 002e 28D9     		bls	.L25
 462              	.L24:
 463              	.LVL41:
 464              		.loc 1 315 47 discriminator 3 view .LVU165
 465 0030 0AB1     		cbz	r2, .L26
 316:lib/chibios/os/oslib/src/chmemheaps.c ****         ((H_NEXT(qp) == NULL) || (hp < H_NEXT(qp)))) {
 466              		.loc 1 316 31 view .LVU166
 467 0032 9542     		cmp	r5, r2
 468 0034 25D2     		bcs	.L25
 469              	.L26:
 317:lib/chibios/os/oslib/src/chmemheaps.c ****       /* Insertion after qp.*/
 318:lib/chibios/os/oslib/src/chmemheaps.c ****       H_NEXT(hp) = H_NEXT(qp);
 470              		.loc 1 318 7 is_stmt 1 view .LVU167
 471              		.loc 1 318 18 is_stmt 0 view .LVU168
 472 0036 44F8082C 		str	r2, [r4, #-8]
 319:lib/chibios/os/oslib/src/chmemheaps.c ****       H_NEXT(qp) = hp;
 473              		.loc 1 319 7 is_stmt 1 view .LVU169
 320:lib/chibios/os/oslib/src/chmemheaps.c ****       /* Verifies if the newly inserted block should be merged.*/
 321:lib/chibios/os/oslib/src/chmemheaps.c ****       if (H_LIMIT(hp) == H_NEXT(hp)) {
 474              		.loc 1 321 11 is_stmt 0 view .LVU170
 475 003a 54F8042C 		ldr	r2, [r4, #-4]
 319:lib/chibios/os/oslib/src/chmemheaps.c ****       H_NEXT(qp) = hp;
 476              		.loc 1 319 18 view .LVU171
 477 003e 1D60     		str	r5, [r3]
 478              		.loc 1 321 7 is_stmt 1 view .LVU172
 479              		.loc 1 321 26 is_stmt 0 view .LVU173
 480 0040 54F8081C 		ldr	r1, [r4, #-8]
 481              		.loc 1 321 11 view .LVU174
 482 0044 0132     		adds	r2, r2, #1
 483 0046 05EBC206 		add	r6, r5, r2, lsl #3
 484              		.loc 1 321 10 view .LVU175
 485 004a B142     		cmp	r1, r6
 486 004c 06D1     		bne	.L27
 322:lib/chibios/os/oslib/src/chmemheaps.c ****         /* Merge with the next block.*/
 323:lib/chibios/os/oslib/src/chmemheaps.c ****         H_PAGES(hp) += H_PAGES(H_NEXT(hp)) + 1U;
 487              		.loc 1 323 9 is_stmt 1 view .LVU176
 488              		.loc 1 323 21 is_stmt 0 view .LVU177
 489 004e 4E68     		ldr	r6, [r1, #4]
 490 0050 1644     		add	r6, r6, r2
 324:lib/chibios/os/oslib/src/chmemheaps.c ****         H_NEXT(hp) = H_NEXT(H_NEXT(hp));
 491              		.loc 1 324 22 view .LVU178
 492 0052 0A68     		ldr	r2, [r1]
 323:lib/chibios/os/oslib/src/chmemheaps.c ****         H_NEXT(hp) = H_NEXT(H_NEXT(hp));
 493              		.loc 1 323 21 view .LVU179
 494 0054 44F8046C 		str	r6, [r4, #-4]
 495              		.loc 1 324 9 is_stmt 1 view .LVU180
 496              		.loc 1 324 20 is_stmt 0 view .LVU181
 497 0058 44F8082C 		str	r2, [r4, #-8]
 498              	.L27:
 325:lib/chibios/os/oslib/src/chmemheaps.c ****       }
 326:lib/chibios/os/oslib/src/chmemheaps.c ****       if ((H_LIMIT(qp) == hp)) {
 499              		.loc 1 326 7 is_stmt 1 view .LVU182
 500              		.loc 1 326 12 is_stmt 0 view .LVU183
 501 005c 5968     		ldr	r1, [r3, #4]
 502 005e 4A1C     		adds	r2, r1, #1
 503 0060 03EBC202 		add	r2, r3, r2, lsl #3
 504              		.loc 1 326 10 view .LVU184
 505 0064 9542     		cmp	r5, r2
 506 0066 07D1     		bne	.L28
 327:lib/chibios/os/oslib/src/chmemheaps.c ****         /* Merge with the previous block.*/
 328:lib/chibios/os/oslib/src/chmemheaps.c ****         H_PAGES(qp) += H_PAGES(hp) + 1U;
 507              		.loc 1 328 9 is_stmt 1 view .LVU185
 508              		.loc 1 328 21 is_stmt 0 view .LVU186
 509 0068 54F8042C 		ldr	r2, [r4, #-4]
 510 006c 0132     		adds	r2, r2, #1
 511 006e 0A44     		add	r2, r2, r1
 512 0070 5A60     		str	r2, [r3, #4]
 329:lib/chibios/os/oslib/src/chmemheaps.c ****         H_NEXT(qp) = H_NEXT(hp);
 513              		.loc 1 329 9 is_stmt 1 view .LVU187
 514              		.loc 1 329 22 is_stmt 0 view .LVU188
 515 0072 54F8082C 		ldr	r2, [r4, #-8]
 516              		.loc 1 329 20 view .LVU189
 517 0076 1A60     		str	r2, [r3]
 518              	.L28:
 330:lib/chibios/os/oslib/src/chmemheaps.c ****       }
 331:lib/chibios/os/oslib/src/chmemheaps.c ****       break;
 519              		.loc 1 331 7 is_stmt 1 view .LVU190
 332:lib/chibios/os/oslib/src/chmemheaps.c ****     }
 333:lib/chibios/os/oslib/src/chmemheaps.c ****     qp = H_NEXT(qp);
 334:lib/chibios/os/oslib/src/chmemheaps.c ****   }
 335:lib/chibios/os/oslib/src/chmemheaps.c **** 
 336:lib/chibios/os/oslib/src/chmemheaps.c ****   /* Releasing heap mutex/semaphore.*/
 337:lib/chibios/os/oslib/src/chmemheaps.c ****   H_UNLOCK(heapp);
 520              		.loc 1 337 3 view .LVU191
 338:lib/chibios/os/oslib/src/chmemheaps.c **** 
 339:lib/chibios/os/oslib/src/chmemheaps.c ****   return;
 340:lib/chibios/os/oslib/src/chmemheaps.c **** }
 521              		.loc 1 340 1 is_stmt 0 view .LVU192
 522 0078 02B0     		add	sp, sp, #8
 523              		.cfi_remember_state
 524              		.cfi_def_cfa_offset 16
 525              		@ sp needed
 526 007a BDE87040 		pop	{r4, r5, r6, lr}
 527              		.cfi_restore 14
 528              		.cfi_restore 6
 529              		.cfi_restore 5
 530              		.cfi_restore 4
 531              		.cfi_def_cfa_offset 0
 532              	.LVL42:
 337:lib/chibios/os/oslib/src/chmemheaps.c **** 
 533              		.loc 1 337 3 view .LVU193
 534 007e FFF7FEBF 		b	chMtxUnlock
 535              	.LVL43:
 536              	.L25:
 537              		.cfi_restore_state
 333:lib/chibios/os/oslib/src/chmemheaps.c ****   }
 538              		.loc 1 333 5 is_stmt 1 view .LVU194
 333:lib/chibios/os/oslib/src/chmemheaps.c ****   }
 539              		.loc 1 333 8 is_stmt 0 view .LVU195
 540 0082 1346     		mov	r3, r2
 541              	.LVL44:
 312:lib/chibios/os/oslib/src/chmemheaps.c ****     chDbgAssert((hp < qp) || (hp >= H_LIMIT(qp)), "within free block");
 542              		.loc 1 312 9 is_stmt 1 view .LVU196
 313:lib/chibios/os/oslib/src/chmemheaps.c **** 
 543              		.loc 1 313 5 is_stmt 0 view .LVU197
 544 0084 CFE7     		b	.L29
 545              		.cfi_endproc
 546              	.LFE292:
 548              		.section	.text.chHeapStatus,"ax",%progbits
 549              		.align	1
 550              		.global	chHeapStatus
 551              		.syntax unified
 552              		.thumb
 553              		.thumb_func
 554              		.fpu fpv4-sp-d16
 556              	chHeapStatus:
 557              	.LVL45:
 558              	.LFB293:
 341:lib/chibios/os/oslib/src/chmemheaps.c **** 
 342:lib/chibios/os/oslib/src/chmemheaps.c **** /**
 343:lib/chibios/os/oslib/src/chmemheaps.c ****  * @brief   Reports the heap status.
 344:lib/chibios/os/oslib/src/chmemheaps.c ****  * @note    This function is meant to be used in the test suite, it should
 345:lib/chibios/os/oslib/src/chmemheaps.c ****  *          not be really useful for the application code.
 346:lib/chibios/os/oslib/src/chmemheaps.c ****  *
 347:lib/chibios/os/oslib/src/chmemheaps.c ****  * @param[in] heapp     pointer to a heap descriptor or @p NULL in order to
 348:lib/chibios/os/oslib/src/chmemheaps.c ****  *                      access the default heap.
 349:lib/chibios/os/oslib/src/chmemheaps.c ****  * @param[in] totalp    pointer to a variable that will receive the total
 350:lib/chibios/os/oslib/src/chmemheaps.c ****  *                      fragmented free space or @p NULL
 351:lib/chibios/os/oslib/src/chmemheaps.c ****  * @param[in] largestp  pointer to a variable that will receive the largest
 352:lib/chibios/os/oslib/src/chmemheaps.c ****  *                      free free block found space or @p NULL
 353:lib/chibios/os/oslib/src/chmemheaps.c ****  * @return              The number of fragments in the heap.
 354:lib/chibios/os/oslib/src/chmemheaps.c ****  *
 355:lib/chibios/os/oslib/src/chmemheaps.c ****  * @api
 356:lib/chibios/os/oslib/src/chmemheaps.c ****  */
 357:lib/chibios/os/oslib/src/chmemheaps.c **** size_t chHeapStatus(memory_heap_t *heapp, size_t *totalp, size_t *largestp) {
 559              		.loc 1 357 77 is_stmt 1 view -0
 560              		.cfi_startproc
 561              		@ args = 0, pretend = 0, frame = 8
 562              		@ frame_needed = 0, uses_anonymous_args = 0
 358:lib/chibios/os/oslib/src/chmemheaps.c ****   heap_header_t *qp;
 563              		.loc 1 358 3 view .LVU199
 359:lib/chibios/os/oslib/src/chmemheaps.c ****   size_t n, tpages, lpages;
 564              		.loc 1 359 3 view .LVU200
 360:lib/chibios/os/oslib/src/chmemheaps.c **** 
 361:lib/chibios/os/oslib/src/chmemheaps.c ****   if (heapp == NULL) {
 565              		.loc 1 361 3 view .LVU201
 357:lib/chibios/os/oslib/src/chmemheaps.c ****   heap_header_t *qp;
 566              		.loc 1 357 77 is_stmt 0 view .LVU202
 567 0000 2DE9F341 		push	{r0, r1, r4, r5, r6, r7, r8, lr}
 568              		.cfi_def_cfa_offset 32
 569              		.cfi_offset 4, -24
 570              		.cfi_offset 5, -20
 571              		.cfi_offset 6, -16
 572              		.cfi_offset 7, -12
 573              		.cfi_offset 8, -8
 574              		.cfi_offset 14, -4
 362:lib/chibios/os/oslib/src/chmemheaps.c ****     heapp = &default_heap;
 575              		.loc 1 362 11 view .LVU203
 576 0004 124C     		ldr	r4, .L45
 577 0006 0028     		cmp	r0, #0
 578 0008 18BF     		it	ne
 579 000a 0446     		movne	r4, r0
 580              	.LVL46:
 363:lib/chibios/os/oslib/src/chmemheaps.c ****   }
 364:lib/chibios/os/oslib/src/chmemheaps.c **** 
 365:lib/chibios/os/oslib/src/chmemheaps.c ****   H_LOCK(heapp);
 581              		.loc 1 365 3 is_stmt 1 view .LVU204
 582 000c 04F10C00 		add	r0, r4, #12
 583 0010 0190     		str	r0, [sp, #4]
 357:lib/chibios/os/oslib/src/chmemheaps.c ****   heap_header_t *qp;
 584              		.loc 1 357 77 is_stmt 0 view .LVU205
 585 0012 0F46     		mov	r7, r1
 586 0014 1646     		mov	r6, r2
 587              		.loc 1 365 3 view .LVU206
 588 0016 FFF7FEFF 		bl	chMtxLock
 589              	.LVL47:
 366:lib/chibios/os/oslib/src/chmemheaps.c ****   tpages = 0U;
 590              		.loc 1 366 3 is_stmt 1 view .LVU207
 367:lib/chibios/os/oslib/src/chmemheaps.c ****   lpages = 0U;
 591              		.loc 1 367 3 view .LVU208
 368:lib/chibios/os/oslib/src/chmemheaps.c ****   n = 0U;
 592              		.loc 1 368 3 view .LVU209
 369:lib/chibios/os/oslib/src/chmemheaps.c ****   qp = &heapp->header;
 593              		.loc 1 369 3 view .LVU210
 594              		.loc 1 369 6 is_stmt 0 view .LVU211
 595 001a 231D     		adds	r3, r4, #4
 596              	.LVL48:
 370:lib/chibios/os/oslib/src/chmemheaps.c ****   while (H_NEXT(qp) != NULL) {
 597              		.loc 1 370 3 is_stmt 1 view .LVU212
 598              		.loc 1 370 9 is_stmt 0 view .LVU213
 599 001c 0198     		ldr	r0, [sp, #4]
 367:lib/chibios/os/oslib/src/chmemheaps.c ****   n = 0U;
 600              		.loc 1 367 10 view .LVU214
 601 001e 0024     		movs	r4, #0
 602              	.LVL49:
 366:lib/chibios/os/oslib/src/chmemheaps.c ****   lpages = 0U;
 603              		.loc 1 366 10 view .LVU215
 604 0020 2546     		mov	r5, r4
 368:lib/chibios/os/oslib/src/chmemheaps.c ****   qp = &heapp->header;
 605              		.loc 1 368 5 view .LVU216
 606 0022 A046     		mov	r8, r4
 607              	.LVL50:
 608              	.L35:
 609              		.loc 1 370 21 is_stmt 1 view .LVU217
 610              		.loc 1 370 10 is_stmt 0 view .LVU218
 611 0024 1B68     		ldr	r3, [r3]
 612              	.LVL51:
 613              		.loc 1 370 21 view .LVU219
 614 0026 5BB9     		cbnz	r3, .L36
 371:lib/chibios/os/oslib/src/chmemheaps.c ****     size_t pages = H_PAGES(H_NEXT(qp));
 372:lib/chibios/os/oslib/src/chmemheaps.c **** 
 373:lib/chibios/os/oslib/src/chmemheaps.c ****     /* Updating counters.*/
 374:lib/chibios/os/oslib/src/chmemheaps.c ****     n++;
 375:lib/chibios/os/oslib/src/chmemheaps.c ****     tpages += pages;
 376:lib/chibios/os/oslib/src/chmemheaps.c ****     if (pages > lpages) {
 377:lib/chibios/os/oslib/src/chmemheaps.c ****       lpages = pages;
 378:lib/chibios/os/oslib/src/chmemheaps.c ****     }
 379:lib/chibios/os/oslib/src/chmemheaps.c **** 
 380:lib/chibios/os/oslib/src/chmemheaps.c ****     qp = H_NEXT(qp);
 381:lib/chibios/os/oslib/src/chmemheaps.c ****   }
 382:lib/chibios/os/oslib/src/chmemheaps.c **** 
 383:lib/chibios/os/oslib/src/chmemheaps.c ****   /* Writing out fragmented free memory.*/
 384:lib/chibios/os/oslib/src/chmemheaps.c ****   if (totalp != NULL) {
 615              		.loc 1 384 3 is_stmt 1 view .LVU220
 616              		.loc 1 384 6 is_stmt 0 view .LVU221
 617 0028 0FB1     		cbz	r7, .L37
 385:lib/chibios/os/oslib/src/chmemheaps.c ****     *totalp = tpages * CH_HEAP_ALIGNMENT;
 618              		.loc 1 385 5 is_stmt 1 view .LVU222
 619              		.loc 1 385 22 is_stmt 0 view .LVU223
 620 002a ED00     		lsls	r5, r5, #3
 621              	.LVL52:
 622              		.loc 1 385 13 view .LVU224
 623 002c 3D60     		str	r5, [r7]
 624              	.L37:
 386:lib/chibios/os/oslib/src/chmemheaps.c ****   }
 387:lib/chibios/os/oslib/src/chmemheaps.c **** 
 388:lib/chibios/os/oslib/src/chmemheaps.c ****   /* Writing out unfragmented free memory.*/
 389:lib/chibios/os/oslib/src/chmemheaps.c ****   if (largestp != NULL) {
 625              		.loc 1 389 3 is_stmt 1 view .LVU225
 626              		.loc 1 389 6 is_stmt 0 view .LVU226
 627 002e 0EB1     		cbz	r6, .L38
 390:lib/chibios/os/oslib/src/chmemheaps.c ****     *largestp = lpages * CH_HEAP_ALIGNMENT;
 628              		.loc 1 390 5 is_stmt 1 view .LVU227
 629              		.loc 1 390 24 is_stmt 0 view .LVU228
 630 0030 E400     		lsls	r4, r4, #3
 631              	.LVL53:
 632              		.loc 1 390 15 view .LVU229
 633 0032 3460     		str	r4, [r6]
 634              	.L38:
 391:lib/chibios/os/oslib/src/chmemheaps.c ****   }
 392:lib/chibios/os/oslib/src/chmemheaps.c ****   H_UNLOCK(heapp);
 635              		.loc 1 392 3 is_stmt 1 view .LVU230
 636 0034 FFF7FEFF 		bl	chMtxUnlock
 637              	.LVL54:
 393:lib/chibios/os/oslib/src/chmemheaps.c **** 
 394:lib/chibios/os/oslib/src/chmemheaps.c ****   return n;
 638              		.loc 1 394 3 view .LVU231
 395:lib/chibios/os/oslib/src/chmemheaps.c **** }
 639              		.loc 1 395 1 is_stmt 0 view .LVU232
 640 0038 4046     		mov	r0, r8
 641 003a 02B0     		add	sp, sp, #8
 642              		.cfi_remember_state
 643              		.cfi_def_cfa_offset 24
 644              		@ sp needed
 645 003c BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 646              	.LVL55:
 647              	.L36:
 648              		.cfi_restore_state
 649              	.LBB7:
 371:lib/chibios/os/oslib/src/chmemheaps.c **** 
 650              		.loc 1 371 5 is_stmt 1 view .LVU233
 371:lib/chibios/os/oslib/src/chmemheaps.c **** 
 651              		.loc 1 371 12 is_stmt 0 view .LVU234
 652 0040 5A68     		ldr	r2, [r3, #4]
 653              	.LVL56:
 374:lib/chibios/os/oslib/src/chmemheaps.c ****     tpages += pages;
 654              		.loc 1 374 5 is_stmt 1 view .LVU235
 655 0042 9442     		cmp	r4, r2
 374:lib/chibios/os/oslib/src/chmemheaps.c ****     tpages += pages;
 656              		.loc 1 374 6 is_stmt 0 view .LVU236
 657 0044 08F10108 		add	r8, r8, #1
 658              	.LVL57:
 375:lib/chibios/os/oslib/src/chmemheaps.c ****     if (pages > lpages) {
 659              		.loc 1 375 5 is_stmt 1 view .LVU237
 375:lib/chibios/os/oslib/src/chmemheaps.c ****     if (pages > lpages) {
 660              		.loc 1 375 12 is_stmt 0 view .LVU238
 661 0048 1544     		add	r5, r5, r2
 662              	.LVL58:
 376:lib/chibios/os/oslib/src/chmemheaps.c ****       lpages = pages;
 663              		.loc 1 376 5 is_stmt 1 view .LVU239
 664 004a 38BF     		it	cc
 665 004c 1446     		movcc	r4, r2
 666              	.LVL59:
 376:lib/chibios/os/oslib/src/chmemheaps.c ****       lpages = pages;
 667              		.loc 1 376 5 is_stmt 0 view .LVU240
 668 004e E9E7     		b	.L35
 669              	.L46:
 670              		.align	2
 671              	.L45:
 672 0050 00000000 		.word	.LANCHOR0
 673              	.LBE7:
 674              		.cfi_endproc
 675              	.LFE293:
 677              		.section	.bss.default_heap,"aw",%nobits
 678              		.align	2
 679              		.set	.LANCHOR0,. + 0
 682              	default_heap:
 683 0000 00000000 		.space	28
 683      00000000 
 683      00000000 
 683      00000000 
 683      00000000 
 684              		.text
 685              	.Letext0:
 686              		.file 2 "/usr/lib/gcc/arm-none-eabi/11.2.0/include/stddef.h"
 687              		.file 3 "/usr/arm-none-eabi/include/machine/_default_types.h"
 688              		.file 4 "/usr/arm-none-eabi/include/sys/_stdint.h"
 689              		.file 5 "./lib/chibios/os/common/ports/ARMCMx/compilers/GCC/chtypes.h"
 690              		.file 6 "./lib/chibios/os/rt/include/chsystypes.h"
 691              		.file 7 "./lib/chibios/os/rt/include/chschd.h"
 692              		.file 8 "./lib/chibios/os/rt/include/chlists.h"
 693              		.file 9 "./lib/chibios/os/common/ports/ARMCMx/chcore.h"
 694              		.file 10 "./lib/chibios/os/common/ports/ARMCMx/chcore_v7m.h"
 695              		.file 11 "./lib/chibios/os/rt/include/chsem.h"
 696              		.file 12 "./lib/chibios/os/rt/include/chmtx.h"
 697              		.file 13 "./lib/chibios/os/oslib/include/chmemcore.h"
 698              		.file 14 "./lib/chibios/os/oslib/include/chmemheaps.h"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 chmemheaps.c
     /tmp/cc0LUCqK.s:18     .text._heap_init:0000000000000000 $t
     /tmp/cc0LUCqK.s:26     .text._heap_init:0000000000000000 _heap_init
     /tmp/cc0LUCqK.s:51     .text._heap_init:0000000000000014 $d
     /tmp/cc0LUCqK.s:57     .text.chHeapObjectInit:0000000000000000 $t
     /tmp/cc0LUCqK.s:64     .text.chHeapObjectInit:0000000000000000 chHeapObjectInit
     /tmp/cc0LUCqK.s:126    .text.chHeapAllocAligned:0000000000000000 $t
     /tmp/cc0LUCqK.s:133    .text.chHeapAllocAligned:0000000000000000 chHeapAllocAligned
     /tmp/cc0LUCqK.s:383    .text.chHeapAllocAligned:00000000000000e0 $d
     /tmp/cc0LUCqK.s:389    .text.chHeapFree:0000000000000000 $t
     /tmp/cc0LUCqK.s:396    .text.chHeapFree:0000000000000000 chHeapFree
     /tmp/cc0LUCqK.s:549    .text.chHeapStatus:0000000000000000 $t
     /tmp/cc0LUCqK.s:556    .text.chHeapStatus:0000000000000000 chHeapStatus
     /tmp/cc0LUCqK.s:672    .text.chHeapStatus:0000000000000050 $d
     /tmp/cc0LUCqK.s:678    .bss.default_heap:0000000000000000 $d
     /tmp/cc0LUCqK.s:682    .bss.default_heap:0000000000000000 default_heap

UNDEFINED SYMBOLS
chMtxObjectInit
chCoreAllocFromTop
chMtxLock
chMtxUnlock
